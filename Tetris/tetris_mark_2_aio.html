<html lang="en"> <head> <meta charset="UTF-8"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <meta http-equiv="X-UA-Compatible" content="ie=edge"/> <title>Tetrisz√£o TOP</title> <style>td{height: 30px; width: 30px;}.filled{background-color: black;}.normal{background-color: white;}.piece{background-color: rgb(6, 102, 228);}</style> </head> <body> <table id="table"></table> </body>
  <script>
    render=(()=>{let e=document.getElementById("table"),o="<tbody>";for(let e=0;e<height;e++){let t="<tr>";for(let o=0;o<width;o++)1==board[o][e]?t+="<td class='filled'></td>":2==board[o][e]?t+="<td class='piece'></td>":t+="<td class='normal'></td>";o+=t+="</tr>"}o+="</tbody>",e.innerHTML=o});var pieces=[{dimensions:4,forms:[[[1,1],[0,1],[2,1],[3,1]],[[1,1],[1,0],[1,2],[1,3]]]},{dimensions:2,forms:[[[0,0],[1,0],[1,1],[0,1]]]},{dimensions:3,forms:[[[1,1],[0,2],[0,1],[2,1]],[[1,1],[1,2],[0,0],[1,0]],[[1,1],[0,1],[2,1],[2,0]],[[1,1],[1,0],[1,2],[2,2]]]},{dimensions:3,forms:[[[1,1],[0,1],[2,1],[2,2]],[[1,1],[1,0],[1,2],[0,2]],[[1,1],[0,1],[2,1],[0,0]],[[1,1],[1,0],[1,2],[2,0]]]},{dimensions:3,forms:[[[1,1],[0,1],[1,2],[2,2]],[[1,1],[1,2],[2,1],[2,0]]]},{dimensions:3,forms:[[[1,1],[0,2],[1,2],[2,1]],[[1,1],[1,0],[2,1],[2,2]]]},{dimensions:3,forms:[[[1,1],[0,1],[1,2],[2,1]],[[1,1],[1,0],[0,1],[1,2]],[[1,1],[0,1],[2,1],[1,0]],[[1,1],[1,0],[1,2],[2,1]]]}];const width=12,height=20;randomChoice=(e=>{return e[Math.floor(Math.random()*e.length)]});var c_piece={piece:randomChoice(pieces),location:{x:Math.round(width/2),y:3},phase:0};let board=[];var canRotateInput=!0;document.onkeypress=(e=>{119==e.keyCode&&canRotateInput&&(rotatePiece(),canRotateInput=!1,setTimeout(()=>{canRotateInput=!0},100)),97==e.keyCode&&canMove("Left")&&move("Left"),100==e.keyCode&&canMove("Right")&&move("Right"),115==e.keyCode&&logic()}),logic=(()=>{if(canMove("Down"))move("Down");else for(let e=0;e<width;e++)for(let o=0;o<height;o++)2==board[e][o]&&(board[e][o]=1);let{line:e,y:o}=hasLine();e&&deleteLine(o),hasPiece()||spawnPiece()}),deleteLine=(e=>{for(let o=e;o>0;o--)for(let e=0;e<width;e++)board[e][o]=board[e][o-1],board[e][o-1]=0;board[0][0]=1,board[width-1][0]=1}),hasLine=(()=>{for(let e=0;e<height-1;e++){let o=!0;for(let t=0;t<width;t++)o=1==board[t][e]&&o;if(o)return{line:o,y:e}}return!1}),setup=(()=>{for(let e=0;e<width;e++){board.push([]);for(let o=0;o<height;o++)0==e||e==width-1||o==height-1?board[e].push(1):board[e].push(0)}}),setup(),setInterval(render,20),setInterval(logic,1e3),move=(e=>{"Left"==e?(clearPiece(),c_piece.location={x:c_piece.location.x-1,y:c_piece.location.y},placePiece()):"Right"==e?(clearPiece(),c_piece.location={x:c_piece.location.x+1,y:c_piece.location.y},placePiece()):"Down"==e&&(clearPiece(),c_piece.location={x:c_piece.location.x,y:c_piece.location.y+1},placePiece())}),rotatePiece=(()=>{canRotate()&&(c_piece.phase=(c_piece.phase+1)%c_piece.piece.forms.length,clearPiece(),placePiece())}),canRotate=(()=>{let e={x:c_piece.location.x,y:c_piece.location.y},o=c_piece.location.x+c_piece.piece.dimensions,t=c_piece.location.y+c_piece.piece.dimensions;for(let i=e.x;i<o;i++)for(let o=e.y;o<t;o++)try{if(1==board[i][o])return!1}catch{}return canRotateInput}),placePiece=(()=>{for(let e of c_piece.piece.forms[c_piece.phase])board[c_piece.location.x+e[0]][c_piece.location.y+e[1]]=2}),clearPiece=(()=>{let e={x:c_piece.location.x,y:c_piece.location.y},o=c_piece.location.x+5,t=c_piece.location.y+5;for(let i=e.x;i<o;i++)for(let o=e.y;o<t;o++)try{2==board[i][o]&&(board[i][o]=0)}catch{}}),spawnPiece=(()=>{c_piece={piece:randomChoice(pieces),location:{x:Math.round(width/2),y:0},phase:0}}),hasPiece=(()=>{for(let e=1;e<width;e++)for(let o=0;o<height;o++)if(2==board[e][o])return!0;return!1}),canMove=(e=>{if("Left"==e){for(let e=1;e<width;e++)for(let o=0;o<height;o++)if(2==board[e][o]&&1==board[e-1][o])return!1}else if("Right"==e){for(let e=0;e<width-1;e++)for(let o=0;o<height;o++)if(2==board[e][o]&&1==board[e+1][o])return!1}else if("Down"==e)for(let e=0;e<width;e++)for(let o=0;o<height;o++)if(2==board[e][o]&&1==board[e][o+1])return!1;return!0});
  </script>
</html>
